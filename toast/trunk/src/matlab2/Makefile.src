include $(TOASTDIR)/Makefile.incl
SHELL = /bin/csh
VPATH = $(TSRC)/matlab2

TGTSRC = toast.cc
TGTOBJ = ${TGTSRC:.cc=.$(MEXEXT)}

AUXSRC = matlabtoast.cc toastmex.cc util.cc mtMesh.cc mtElement.cc mtQMvec.cc mtBasis.cc mtField.cc mtGradient.cc mtJacobian.cc mtRegul.cc toastlbfgs.cc mtSysmat_basis.cc

ifeq ($(BUILD_FDOT),1)
  AUXSRC +=  matlabfdot.cc
endif

AUXOBJ = ${AUXSRC:.cc=.o}

all:: $(TGTOBJ)

%.o : %.cc
	$(MEX) $(MEXINC) -c $<

%.$(MEXEXT) : %.cc $(AUXOBJ)
	$(MEX) $(MEXINC) $(MEXLIB) $^

clean::
	rm -f *.$(MEXEXT)
	rm -f *.o
